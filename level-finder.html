<!DOCTYPE html>
<html lang="en" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Level Finder Quiz - Golden Fellows English</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="css/style.css">

    <script>
        // Theme loader script
        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    </script>
</head>
<body class="font-brand antialiased text-gray-900 dark:text-gray-200">

    <main class="flex items-center justify-center min-h-screen p-4 sm:p-6 md:p-8">
        <div class="w-full max-w-2xl mx-auto animate-in" style="animation-delay: 100ms;">
            
            <header class="text-center mb-10">
                <h1 class="text-5xl font-bold text-teal-600 dark:text-teal-400">Level Finder Quest</h1>
                <p class="text-gray-600 dark:text-gray-400 mt-3 text-lg">Your first step towards fluency. This helps us place you perfectly.</p>
            </header>

            <div id="quiz-card" class="bg-white dark:bg-slate-800 p-8 sm:p-10 rounded-2xl shadow-xl border border-stone-200/50 dark:border-slate-700/50">
                
                <div id="step-intro" class="text-center space-y-6">
                    <p class="text-xl font-semibold">Welcome, Fellow!</p>
                    <p class="text-gray-600 dark:text-gray-400">This brief assessment has **two parts**: a writing task and a speaking task. It should take about 10-15 minutes.</p>
                    <div class="p-4 bg-indigo-50 dark:bg-indigo-900/40 rounded-lg">
                        <p class="text-indigo-800 dark:text-indigo-200 font-bold">Remember:</p>
                        <p class="text-sm text-indigo-700 dark:text-indigo-300">Answer as accurately as you can. We are looking for what you *can* do, not what you *can't*.</p>
                    </div>
                    <button id="start-quiz-btn" class="w-full px-6 py-3 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition font-semibold shadow-md">Start the Quest â†’</button>
                </div>

                <form id="level-finder-form" class="hidden space-y-8">
                    
                    <div class="space-y-2">
                        <p class="text-sm font-semibold text-gray-700 dark:text-gray-300 flex justify-between">
                            <span>Quest Progress</span>
                            <span id="step-status">1/2</span>
                        </p>
                        <div class="w-full bg-gray-200 dark:bg-slate-700 rounded-full h-2.5">
                            <div id="progress-bar" class="bg-teal-500 h-2.5 rounded-full transition-all duration-500" style="width: 50%"></div>
                        </div>
                    </div>

                    <div id="step-1" class="step-content">
                        <h3 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-200">1. Writing Task (150-200 words)</h3>
                        <p class="mb-4 text-gray-600 dark:text-gray-400 font-typewriter italic">"Describe a significant challenge you have faced and how learning English will help you overcome a future professional challenge."</p>
                        <textarea id="writing-input" rows="8" class="w-full p-4 border border-stone-300 dark:border-gray-600 rounded-lg bg-stone-50 dark:bg-slate-900 focus:outline-none focus:ring-2 focus:ring-teal-500" placeholder="Start typing your response here... (Aim for 150+ words)" required></textarea>
                        <div id="word-count" class="text-sm text-right text-gray-500 dark:text-gray-400 mt-1">0 words</div>
                        <button type="button" id="next-to-speaking-btn" class="mt-6 w-full px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition font-semibold shadow-md disabled:opacity-50" disabled>Continue to Speaking Task</button>
                    </div>

                    <div id="step-2" class="step-content hidden">
                        <h3 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-200">2. Speaking Task (Record 60-90 seconds)</h3>
                        <p class="mb-4 text-gray-600 dark:text-gray-400 font-typewriter italic">"Talk about a current global event. What is your opinion on it, and what are the potential long-term effects?"</p>

                        <div id="recording-controls" class="p-6 bg-stone-50 dark:bg-slate-900 rounded-xl space-y-4 text-center">
                            <p id="mic-status" class="text-red-600 dark:text-red-400 font-semibold">Microphone not initialized.</p>
                            <p id="timer" class="text-3xl font-mono font-bold">0:00</p>
                            
                            <button type="button" id="record-btn" class="w-20 h-20 bg-red-500 text-white rounded-full hover:bg-red-600 transition disabled:opacity-50 flex items-center justify-center mx-auto" disabled>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4z" clip-rule="evenodd" /><path d="M15.536 8.464a.5.5 0 01.127.568 6.502 6.502 0 01-11.326 0 .5.5 0 01.127-.568l.455-.455a.5.5 0 01.707 0 5.502 5.502 0 009.612 0 .5.5 0 01.707 0l.455.455z" /></svg>
                            </button>
                            <audio id="audio-playback" controls class="w-full hidden"></audio>
                            <p id="recorded-message" class="text-teal-600 dark:text-teal-400 font-semibold hidden">Recording saved. Click Submit!</p>
                        </div>
                        
                        <button type="submit" id="submit-all-btn" class="mt-6 w-full px-6 py-3 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition font-semibold shadow-md disabled:opacity-50" disabled>Submit Final Assessment</button>
                    </div>

                </form>

                <div id="step-confirmation" class="text-center space-y-6 hidden">
                    <h3 class="text-3xl font-bold text-teal-600 dark:text-teal-400">Assessment Submitted!</h3>
                    <p class="text-gray-600 dark:text-gray-400 text-lg">Thank you for completing the Level Finder Quest. Your submissions are being reviewed by an instructor.</p>
                    <p class="text-sm font-semibold">You will receive your official CEFR placement (A1, B2, etc.) and class assignment within 24 hours.</p>
                    <a href="dashboard.html" class="mt-6 inline-block px-8 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition font-semibold shadow-md">Go to Dashboard</a>
                </div>

            </div>
        </div>
    </main>

    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js" type="module"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js" type="module"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js" type="module"></script>
    
    <script src="js/firebaseconfig.js" type="module"></script>
    <script src="js/level-finder.js" type="module"></script>
    </body>
</html>
